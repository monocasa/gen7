#include <cstdio>
#include <cstdint>
#include <cstring>
#include <memory>

#include "XenosShader.h"

uint32_t testVertexShader[] = {
	0x102a1101, 0x00000104, 0x000000b4, 0x00000000,
	0x00000024, 0x00000000, 0x000000b8, 0x00000000,
	0x00000000, 0x00000090, 0x0000001c, 0x00000083,
	0xfffe0300, 0x00000002, 0x0000001c, 0x00001000,
	0x0000007c, 0x00000044, 0x00020000, 0x00040000,
	0x00000050, 0x00000000, 0x00000060, 0x00020004,
	0x00030000, 0x0000006c, 0x00000000, 0x6d6f6465,
	0x6c566965, 0x7700abab, 0x00030003, 0x00040004,
	0x00010000, 0x00000000, 0x6d6f6465, 0x6c576f72,
	0x6c6400ab, 0x00030003, 0x00040003, 0x00010000,
	0x00000000, 0x76735f33, 0x5f300032, 0x2e302e37,
	0x3638302e, 0x3000abab, 0x00000000, 0x000000b4,
	0x00110002, 0x00000000, 0x00000000, 0x00001c42,
	0x00000001, 0x00000003, 0x00000004, 0x00000290,
	0x00100003, 0x00003004, 0x00205005, 0x00007030,
	0x0003f150, 0x0000000b, 0x0000000c, 0x0000100d,
	0x0000100a, 0x70153003, 0x00001200, 0xc2000000,
	0x00004006, 0x00001200, 0xc4000000, 0x0000400a,
	0x00002200, 0x00000000, 0x05f82000, 0x00000688,
	0x00000000, 0x05f80000, 0x00000447, 0x00000000,
	0x05f81000, 0x00000688, 0x00000000, 0xc801803e,
	0x00a7a700, 0xaf020000, 0xc802803e, 0x00a7a700,
	0xaf020100, 0xc804803e, 0x00a7a700, 0xaf020200,
	0xc808803e, 0x00a7a700, 0xaf020300, 0xc80f8001,
	0x00000000, 0xe2010100, 0xc8018000, 0x00c3be00,
	0xb0000400, 0xc8028000, 0x00c3be00, 0xb0000500,
	0xc8048000, 0x00c3be00, 0xb0000600, 0x00000000,
	0x00000000, 0x00000000,
};

uint32_t testPixelShader[] = {
	0x102a1100, 0x000000dc, 0x00000048, 0x00000000,
	0x00000024, 0x00000000, 0x000000b4, 0x00000000,
	0x00000000, 0x0000008c, 0x0000001c, 0x0000007f,
	0xffff0300, 0x00000002, 0x0000001c, 0x00001000,
	0x00000078, 0x00000044, 0x00020000, 0x00010000,
	0x00000054, 0x00000000, 0x00000064, 0x00030000,
	0x00010000, 0x00000068, 0x00000000, 0x6c696768,
	0x74446972, 0x65637469, 0x6f6e00ab, 0x00010003,
	0x00010004, 0x00010000, 0x00000000, 0x7300abab,
	0x0004000c, 0x00010001, 0x00010000, 0x00000000,
	0x70735f33, 0x5f300032, 0x2e302e37, 0x3638302e,
	0x3000abab, 0x00000000, 0x00000048, 0x10000100,
	0x00000004, 0x00000000, 0x00001c42, 0x00030003,
	0x00000001, 0x00007030, 0x0000f150, 0x00011002,
	0x00001200, 0xc4000000, 0x00002003, 0x00002200,
	0x00000000, 0x10081021, 0x1f1ff688, 0x00004000,
	0xc8010000, 0x00bebe00, 0xb0000000, 0x14878000,
	0x006cc01b, 0xe1000101, 0x00000000, 0x00000000,
	0x00000000,
};

void usage( const char *invocationName )
{
	fprintf( stderr, "Usage:  %s ps|vs\n", invocationName );
}

int main( int argc, char *argv[] )
{
	if( argc != 2 ) {
		usage( argv[0] );
		return 1;
	}

	uint32_t * shaderBinary = nullptr;
	int shaderBinarySize = 0;

	if( strcmp("vs", argv[1]) == 0 ) {
		shaderBinary = testVertexShader;
		shaderBinarySize = sizeof(testVertexShader);
		printf( "==== vs.vsu ====\n" );
	}
	else if( strcmp("ps", argv[1]) == 0 ) {
		shaderBinary = testPixelShader;
		shaderBinarySize = sizeof(testPixelShader);
		printf( "==== ps.psu ====\n" );
	}
	else {
		usage( argv[0] );
		return 1;
	}

	std::unique_ptr<xenosdis::XenosShader> shader( new xenosdis::XenosShader( shaderBinary, shaderBinarySize ) );

	printf( "~~~~ HEADER ~~~~\n" );
	shader->PrintHeader( stdout );
	printf( "~~~~ uC HEADER ~~~~\n" );
	shader->PrintUcHeader( stdout );

	return 0;
}

